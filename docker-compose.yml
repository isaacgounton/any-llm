services:
  gateway:
    # if pulling from ghcr.io, use the following instead, and comment out the build section:
    # image: ghcr.io/mozilla-ai/any-llm/gateway:latest
    build:
      context: .
      dockerfile: Dockerfile
      args:
        VERSION: ${VERSION:-0.0.0+local}
    # If you want to use a different port, change it here and in the config.yml file.
    ports:
      - "8010:8000"
    environment:
      - DATABASE_URL=postgresql://gateway:gateway@postgres:5432/gateway
      - GATEWAY_HOST=0.0.0.0
      - GATEWAY_PORT=8000
      - GATEWAY_MASTER_KEY=${GATEWAY_MASTER_KEY}
      - GOOGLE_CLOUD_PROJECT=${GOOGLE_CLOUD_PROJECT}
      - GOOGLE_CLOUD_LOCATION=${GOOGLE_CLOUD_LOCATION}
      - OPENAI_API_KEY=${OPENAI_API_KEY}
      - ANTHROPIC_API_KEY=${ANTHROPIC_API_KEY}
      - GEMINI_API_KEY=${GEMINI_API_KEY}
      - GOOGLE_API_KEY=${GOOGLE_API_KEY}
      - AZURE_API_KEY=${AZURE_API_KEY}
      - AZURE_OPENAI_API_KEY=${AZURE_OPENAI_API_KEY}
      - AWS_ACCESS_KEY_ID=${AWS_ACCESS_KEY_ID}
      - AWS_SECRET_ACCESS_KEY=${AWS_SECRET_ACCESS_KEY}
      - AWS_BEARER_TOKEN_BEDROCK=${AWS_BEARER_TOKEN_BEDROCK}
      - HF_TOKEN=${HF_TOKEN}
      - MISTRAL_API_KEY=${MISTRAL_API_KEY}
      - COHERE_API_KEY=${COHERE_API_KEY}
      - GROQ_API_KEY=${GROQ_API_KEY}
      - TOGETHER_API_KEY=${TOGETHER_API_KEY}
      - FIREWORKS_API_KEY=${FIREWORKS_API_KEY}
      - DEEPSEEK_API_KEY=${DEEPSEEK_API_KEY}
      - CEREBRAS_API_KEY=${CEREBRAS_API_KEY}
      - SAMBANOVA_API_KEY=${SAMBANOVA_API_KEY}
      - VOYAGE_API_KEY=${VOYAGE_API_KEY}
      - PORTKEY_API_KEY=${PORTKEY_API_KEY}
      - OPENROUTER_API_KEY=${OPENROUTER_API_KEY}
      - PERPLEXITY_API_KEY=${PERPLEXITY_API_KEY}
      - LM_STUDIO_API_KEY=${LM_STUDIO_API_KEY}
      - OLLAMA_API_KEY=${OLLAMA_API_KEY}
      - LLAMACPP_API_KEY=${LLAMACPP_API_KEY}
      - LLAMAFILE_API_KEY=${LLAMAFILE_API_KEY}
      - DATABRICKS_TOKEN=${DATABRICKS_TOKEN}
      - WATSONX_API_KEY=${WATSONX_API_KEY}
      - MOONSHOT_API_KEY=${MOONSHOT_API_KEY}
      - NEBIUS_API_KEY=${NEBIUS_API_KEY}
      - INCEPTION_API_KEY=${INCEPTION_API_KEY}
      - LLAMA_API_KEY=${LLAMA_API_KEY}
      - MINIMAX_API_KEY=${MINIMAX_API_KEY}
      - XAI_API_KEY=${XAI_API_KEY}
      - ZAI_API_KEY=${ZAI_API_KEY}
      - ANY_LLM_KEY=${ANY_LLM_KEY}
      - GATEWAY_API_KEY=${GATEWAY_API_KEY}
    command: ["any-llm-gateway", "serve", "-c", "/app/config.yml"]
    depends_on:
      postgres:
        condition: service_healthy
    restart: unless-stopped

  postgres:
    image: postgres:16-alpine
    environment:
      - POSTGRES_USER=gateway
      - POSTGRES_PASSWORD=gateway
      - POSTGRES_DB=gateway
    volumes:
      - postgres_data:/var/lib/postgresql/data
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -U gateway"]
      interval: 10s
      timeout: 5s
      retries: 5
    restart: unless-stopped

volumes:
  postgres_data:
